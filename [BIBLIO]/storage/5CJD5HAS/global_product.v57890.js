(function(){LOVEFiLM=window.LOVEFiLM||{};LOVEFiLM.bubble=LOVEFiLM.bubble||{};LOVEFiLM.bubble.bubbleHTML=function(css_id,css_class,content){jQuery.each(jQuery.browser,function(i){if($.browser.msie&&parseInt($.browser.version,10)<9){css_class=css_class+" ie";return false;}});content=content=='undefined'?'':content;return'<div id="'+css_id+'" class="bubble_wrapper '+css_class+'"><div class="arrow_wrapper"><div class="arrow"></div></div><div class="content">'+content+'</div></div>';};LOVEFiLM.bubble.bubblePosition=function(hover_details,trigger,type){var offset=trigger.offset();var triggerWidth=trigger.width();var hoverDetailsWidth=hover_details.width();var all_wrap=$('#all_wrap');var wrapperWidth=all_wrap.width();var hoverDetailsPositionTop=offset.top;var offset_left=offset.left;var bubblePosition='side';var page_wrapper=$('body > div.page:first');if(page_wrapper.length>0){var content_offset=page_wrapper.offset();wrapperWidth=Math.round(content_offset.left+page_wrapper.width());}
if(trigger.parents('div.highlight-titles-box').length){wrapperWidth=parseInt(wrapperWidth-80);}
var hoverDetailsPositionLeft=offset_left+triggerWidth;var interim_wrapper=$('.interim-wrapper:first');var left_space=0;if(interim_wrapper.length>0){var wrapper_offset=interim_wrapper.offset();left_space=wrapper_offset.left;offset_left=parseInt(offset_left-left_space);hoverDetailsPositionLeft=parseInt(hoverDetailsPositionLeft-left_space);}
var arrow_hook=hover_details.find('.arrow_wrapper:first');if(bubblePosition=='top'||bubblePosition=='bottom'){$(arrow_hook).removeClass('right_arrow');$(arrow_hook).removeClass('left_arrow');$(arrow_hook).removeClass('top_arrow');$(arrow_hook).removeClass('bottom_arrow');if(bubblePosition=='top'){$(arrow_hook).addClass('bottom_arrow');}else{$(arrow_hook).addClass('top_arrow');}}else if((offset_left+triggerWidth+hoverDetailsWidth)>wrapperWidth){hoverDetailsPositionLeft=offset_left-hoverDetailsWidth;hoverDetailsPositionLeft=parseInt(hoverDetailsPositionLeft-20);$(arrow_hook).removeClass('bottom_arrow');$(arrow_hook).removeClass('left_arrow');$(arrow_hook).removeClass('top_arrow');$(arrow_hook).addClass('right_arrow');}else{$(arrow_hook).removeClass('bottom_arrow');$(arrow_hook).removeClass('right_arrow');$(arrow_hook).removeClass('top_arrow');$(arrow_hook).addClass('left_arrow');}
hoverDetailsPositionLeft=parseInt(hoverDetailsPositionLeft+10);var bubble_height=0;var height_fix=0;if(type=='rental_manger'){bubble_height=hover_details.height();if(bubblePosition=='top'||bubblePosition=='bottom'){var bubble_width=hover_details.width();var arrow_width=$(arrow_hook).width();var move_arrow_left=parseInt((bubble_width/2)-(arrow_width/2));$(arrow_hook).css('left',move_arrow_left+'px');var move_right=parseInt((bubble_width/2)+12);hoverDetailsPositionLeft=parseInt(hoverDetailsPositionLeft-move_right);if(bubblePosition=='top'){height_fix=parseInt(bubble_height+20);}else{height_fix=parseInt(trigger.height()+15);}}else{height_fix=parseInt(bubble_height-30);}}else if(type=='hover_details'){height_fix=20;}
var top_css=bubblePosition=='bottom'?parseInt(hoverDetailsPositionTop+height_fix):parseInt(hoverDetailsPositionTop-height_fix);var centered_content=$('body > div.page:first');var wrapper=all_wrap.length>0?all_wrap:page_wrapper;var wrap_offset;var wrap_top;if(wrapper.length>0){wrap_offset=wrapper.offset();if(all_wrap.length>0){wrap_top=wrap_offset.top;}else{wrap_top=parseInt($('.leaderboard-adblock').outerHeight()+$('.page-header').height()+wrap_offset.top+5);}}
if(top_css<wrap_top){var top_dif=parseInt((wrap_top-top_css)+8);top_css=parseInt(top_css+top_dif);hover_details.find('.arrow_wrapper').css('bottom',top_dif+'px');}
hover_details.css('position','absolute');hover_details.css('top',top_css+'px');hover_details.css('left',hoverDetailsPositionLeft+'px');};}());;(function(){$.fn.RentalButtons=function($params){var $defaults={addingText:LOVEFiLM.i18n.i18n('/global/buttons/btn_adding'),removingText:LOVEFiLM.i18n.i18n('/global/buttons/btn_removing'),reservingText:LOVEFiLM.i18n.i18n('/global/buttons/btn_reserving'),pleaseWaitText:LOVEFiLM.i18n.i18n('/global/queue/notify_loading')};var ajax_in_progress=0;var $p=$defaults;var html_similars_present=0;var self;var newMethods={initiate_rental_buttons:function(){$('a.btn_add, a.btn_remove, a.btn_reserve').processRentalButtonAction();},closeRomFromOutside:function(){var rom=$('#rom');$('#rom a#bubble-close').focus();$("body").one("click",function(){$('#rom').remove();if(typeof showPlayer==='function'){showPlayer();}});rom.click(function(event){event.stopPropagation();});},updateRomEventListners:function(){$("body").one("click",function(){$('#rom').remove();if(typeof showPlayer==='function'){showPlayer();}});$('#rom').click(function(event){event.stopPropagation();});},updateOtherPageButtons:function(json_vars){var disc_level_buttons=json_vars.disc_level_buttons,rollup_button_json=json_vars.rollup_button,title_count=json_vars.unique_title_count||json_vars.uniqueTitleCount;if(title_count){this.updateRentalList(title_count);}
if(disc_level_buttons){var fro_buttons=$('#tabbed_formats #fro_content a.add-to-rentallist').each(function(){var disc_button=$(this),disc_token=disc_button.attr('data-release')||'';jQuery.each(disc_level_buttons,function(i,val){if(i==disc_token){disc_button.text(val.button_text);disc_button.attr('data-queue',val.button_action);disc_button.attr('data-track_event',val.button_track);disc_button.changeButtonClass(val.button_class);var track_activity=disc_button.attr('data-track_activity');switch(val.button_track){case'52:Queue Removal':disc_button.attr('data-track_activity',track_activity.replace("ADD","REMOVE"));break;case'51:Queue Addition':disc_button.attr('data-track_activity',track_activity.replace("REMOVE","ADD"));break;}
return false;}});});}else if(rollup_button_json){var rollup_button=$('#product-summary a.title_page_rolled_up:first');if(rollup_button){rollup_button.html(rollup_button_json.button_text);rollup_button.attr('data-queue',rollup_button_json.button_action||'');rollup_button.attr('data-bonus-queue',rollup_button_json.button_bonus_action||'');rollup_button.attr('title',rollup_button_json.button_title||'');rollup_button.attr('data-track_event',rollup_button_json.button_track);rollup_button.changeButtonClass(rollup_button_json.button_class);var track_activity=rollup_button.attr('data-track_activity');switch(rollup_button_json.button_track){case'52:Queue Removal':rollup_button.attr('data-track_activity',track_activity.replace("ADD","REMOVE"));break;case'51:Queue Addition':rollup_button.attr('data-track_activity',track_activity.replace("REMOVE","ADD"));break;}}
}},processRentalButtonAction:function(){$(this)
.unbind('.bubble')
.bind('click.bubble',function(e){e.preventDefault();if($(this).hasClass('title_page_rolled_up')){self=$(this);}
var $trigger=$(this);if($trigger.hasClass('working')){return;}
hide_bubble=0;if(!$trigger.parents('#rom').length){$('#rom').remove();if(typeof showPlayer==='function'){showPlayer();}}
var is_individual_disc=0;if($trigger.hasClass('individual_disc')){is_individual_disc=1;}
var queue_token=$trigger.attr('data-queue')||'';var bonus_action_token=$trigger.attr('data-bonus-queue')||'';var title_token=$trigger.attr('data-title')||'';var release_token=$trigger.attr('data-release')||'';var number_of_discs=$trigger.attr('data-discs')||'';var rom_type=$trigger.attr('data-rom-type')||'';var DisplayRentalOptions=true;var js_action='';var span_action_format=' '+$trigger.attr('data-product_media')||'';var show_span=0;if(span_action_format){show_span=1;}
if($trigger.hasClass('btn_add')){$trigger.html($p.addingText+span_action_format);var belongs_to_rom=$trigger.parents('#similar_titles').length;js_action='add';}else if($trigger.hasClass('btn_reserve')){js_action='reserve';var belongs_to_rom=$trigger.parents('#similar_titles').length;$trigger.html($p.reservingText+span_action_format);}else if($trigger.hasClass('btn_remove')){js_action='remove';}
var button_type='';if($trigger.hasClass('title_page_rolled_up')){button_type='title_page_rolled_up';show_span=1;}else if($trigger.hasClass('individual_disc')){button_type='individual_disc';}
if(js_action==='remove'){var params={action_token:queue_token,js_action:js_action,bonus_action_token:bonus_action_token||'',title_token:title_token,release_token:release_token,show_span:show_span,rom_type:rom_type,button_type:button_type,response:'json',short_text:$trigger.hasClass('short-text')?1:0}
$trigger.jsonRemove($trigger,params);}else{var params={type:'rent_manager',rom_type:rom_type,js_action:js_action,release_token:release_token,action_token:queue_token,title_token:title_token,show_span:show_span,individual_disc:is_individual_disc,button_type:button_type,reload:0,short_text:$trigger.hasClass('short-text')?1:0}
$trigger.bubbleAjax(params);}});},loadBubbleSniffers:function($bubble,new_uniqueTitleCount){var $button=$(this);var rom_type='normal';var json_vars=$bubble.find('#json').val()||$('#rom').find('#json').val();json_vars=jQuery.parseJSON(json_vars);if(json_vars.has_similars==undefined){$('#rom').removeClass('with-similars');}else{$('#rom').addClass('with-similars');rom_type='with-similars';}
if(json_vars.rom_type&&json_vars.rom_type!=0){rom_type=json_vars.rom_type;}
var uniqueTitleCount=new_uniqueTitleCount||json_vars.unique_title_count,queue_item_token=json_vars.queue_item_token,old_queue_name=json_vars.default_queue_name,new_uniqueTitleCount,is_in_rom_related=$('#rom.rent-from-rom-similars').length>0;if((rom_type&&$bubble.find('.btn_add,.btn_reserve'))||is_in_rom_related){$bubble.find('.btn_add,.btn_reserve').each(function(){var rom_rent_button=$(this);var rom_js_action='add';var title_token_rom=rom_rent_button.attr('data-title');queue_item_token=rom_rent_button.attr('data-queue');old_queue_name=rom_rent_button.attr('data-queue');release_token=rom_rent_button.attr('data-release')||'';var params={title_token:title_token_rom,action_token:queue_item_token,rom_type:'rent-from-rom-similars',type:'rent_manager',js_action:rom_js_action,release_token:release_token,reload:1};$(this)
.unbind('.bubble')
.bind('click.bubble',function(e){e.preventDefault();var update_params={data_title:title_token_rom}
rom_rent_button=$('div#product-summary li a.add-to-rentallist:first');$(this).bubbleRentalOptions(rom_rent_button,params);});});}
if(rom_type&&$bubble.find('.btn_remove')){$bubble.find('.btn_remove').each(function(){$(this).unbind('.bubble').bind('click.bubble',function(e){e.preventDefault();var remove_button=$(this);remove_button.text($p.removingText);DisplayRentalOptions=false;var bonus_token=remove_button.attr('data-bonus-queue')||'';var params={action_token:remove_button.attr('data-queue')||'',bonus_action_token:bonus_token,title_token:remove_button.attr('data-title')||'',release_token:remove_button.attr('data-release')||'',response:'json',rom_type:rom_type,short_text:remove_button.hasClass('short-text')?1:0}
var url='/apps/foundation/ajax/action.html';$.getJSON(url,params,function(json){if(json.success){if(remove_button.attr('data-track_activity')=='QUEUE_REMOVE'){remove_button.attr('data-track_activity','QUEUE_ADD');}
remove_button.attr('data-queue',json.actionToken||'');remove_button.text(json.buttonText);remove_button.attr('data-track_event',json.buttonEvent);remove_button.attr('data-product_media',json.buttonFormat);remove_button.attr('title',json.buttonText||'');remove_button.changeButtonClass(json.buttonClass);new_uniqueTitleCount=json.uniqueTitleCount;}
$(this).loadBubbleSniffers($bubble,new_uniqueTitleCount);});});});}
if(uniqueTitleCount){$('#rentalListCount').updateTopQueue('number',uniqueTitleCount);}
$bubble.find('#rent_pri .change_options select').changePriority($button,queue_item_token,rom_type);$bubble.find('#rent_queue select').changeQueue($button,queue_item_token,old_queue_name,rom_type);var bonus_link=$('#change_bonus a');var bonus_action=bonus_link.attr('rel');var is_remove=bonus_link.hasClass('remove')?1:0;$bubble.find('#change_bonus a').changeBonus($button,queue_item_token,bonus_action,is_remove,rom_type);var added_format=json_vars.added_format;var remove_current=json_vars.new_action_token;var cert_type=json_vars.cert_type;var cert_value=json_vars.cert_value;var priority=$('#rom form #rent_pri select option:selected').val()||0;var remove_bonus_token=is_remove?bonus_action:'';$bubble.find('#change_format select').changeFormat($button,remove_current,added_format,cert_value,cert_type,priority,remove_bonus_token,rom_type);var remove_self=$bubble.find('.info a.remove_self');var remove_self_token=remove_self.attr('data-token')||'';remove_self.bubbleRemoveSelf($button,$bubble,remove_self_token,remove_current);if($('#rom').hasClass('.gallery_wrapper').length){var rom_gallery=$('#rom').find('.gallery_wrapper');if(rom_gallery){rom_gallery.carousel_activate();hide_bubble=0;$("#rom div.star_base").rating_stars();}}},bubbleRemoveSelf:function($button,$bubble,remove_self_token,remove_current){$(this).click(function(e){e.preventDefault();var params={action_token:remove_current,title_token:$button.attr('data-title')||'',remove_self_token:remove_self_token,show_span:show_span,response:'json'};$bubble.loadingRom();$(this).jsonRemove($button,params,$bubble);});},changeBonus:function($button,queue_item_token,bonus_action,is_remove,rom_type){$(this).click(function(e){e.preventDefault();var json_vars=$('#rom form #json').val();json_vars=jQuery.parseJSON(json_vars);var title_token_rom=$button.attr('data-title');var is_in_rom_related=$('#rom.rent-from-rom-similars').length>0;queue_item_token=$button.attr('data-queue');if(rom_type=='rent-from-rom-similars'||is_in_rom_related){title_token_rom=json_vars.title_token;queue_item_token=json_vars.queue_item_token;rom_type='rent-from-rom-similars';var bonus_link=$('#rom form #change_bonus a');bonus_action=bonus_link.attr('rel');is_remove=bonus_link.hasClass('remove')?1:0;}
var button_type='';if($button.hasClass('title_page_rolled_up')){button_type='title_page_rolled_up';}else if($button.hasClass('individual_disc')){button_type='individual_disc';}
var params={reload:1,js_action:'change_bonus',button_type:button_type,title_token:title_token_rom,is_remove:is_remove,action_token:bonus_action,queue_item_token:queue_item_token,rom_type:rom_type};$(this).bubbleRentalOptions($button,params);});},changeFormat:function($button,remove_current,added_format,cert_value,cert_type,priority,remove_bonus_token,rom_type){$(this).change(function(){var title_token_rom=$button.attr('data-title');var is_in_rom_related=$('#rom.rent-from-rom-similars').length>0;var json_vars=$bubble.find('#json').val();json_vars=jQuery.parseJSON(json_vars);var individual_disc=json_vars.individual_disc||0;if(rom_type=='rent-from-rom-similars'||is_in_rom_related){title_token_rom=json_vars.title_token;queue_item_token=json_vars.queue_item_token;added_format=json_vars.added_format;cert_value=json_vars.cert_value;added_format=json_vars.added_format;priority=$('#rom form #rent_pri select option:selected').val()||0;remove_current=json_vars.new_action_token;var bonus_link=$('#rom form #change_bonus a');var bonus_action=bonus_link.attr('rel');var is_remove=bonus_link.hasClass('remove')?1:0;remove_bonus_token=is_remove?bonus_action:'';rom_type='rent-from-rom-similars';}
var button_type='';if($button.hasClass('title_page_rolled_up')){button_type='title_page_rolled_up';}else if($button.hasClass('individual_disc')){button_type='individual_disc';}
html_similars_present=$('#rom #similar_titles').length;var params={reload:1,js_action:'change_format',is_remove:1,button_type:button_type,title_token:title_token_rom,old_format:added_format,old_cert_value:cert_value,old_cert_type:cert_type,old_priority:priority,action_token:remove_current,remove_bonus_token:remove_bonus_token,change_format_token:$(this).val(),rom_type:rom_type,html_similars_present:html_similars_present,individual_disc:individual_disc};$(this).bubbleRentalOptions($button,params);var track_activity=$(this).attr('data-track_activity');var track_data=LOVEFiLM.Tracking.gatherTrackingData($(this).find('option:selected'));LOVEFiLM.Tracking.trackActivity(track_activity,track_data);return false;});},changeQueue:function($button,queue_item_token,old_queue_name,rom_type){$(this).each(function(){var json_vars=$bubble.find('#json').val();json_vars=jQuery.parseJSON(json_vars);old_queue_name=$('#rom form #rent_queue_change option:selected').text();queue_item_token=json_vars.queue_item_token;$(this).change(function(){var title_token_rom=$button.attr('data-title');var is_in_rom_related=$('#rom.rent-from-rom-similars').length>0;var individual_disc=json_vars.individual_disc||0;html_similars_present=$('#rom #similar_titles').length;if(rom_type=='rent-from-rom-similars'||is_in_rom_related){title_token_rom=json_vars.title_token;queue_item_token=json_vars.queue_item_token;rom_type='rent-from-rom-similars';}
$self=$(this);var params={reload:1,js_action:'change_queue',title_token:title_token_rom,queue_item_token:queue_item_token,change_queue_token:$self.val(),change_format_token:json_vars.new_action_token,format:json_vars.added_format,release_token:$button.attr('data-release'),new_queue_name:$self.find(':selected').text(),old_queue_name:old_queue_name,rom_type:rom_type,individual_disc:individual_disc,html_similars_present:html_similars_present};$self.bubbleRentalOptions($button,params);var format=$self.parents('#in_rom_title_options').first().find('#change_format select option:selected').text();$self.attr("data-format",format);var track_data=LOVEFiLM.Tracking.gatherTrackingData($(this).find('option:selected'));LOVEFiLM.Tracking.trackActivity("CHANGE_RENTAL_LIST",track_data);});});},changePriority:function($button,queue_item_token,rom_type){var starting_priority=$('#rent_pri .change_options option:selected').val()||2;$(this).change(function(){var json_vars=$bubble.find('#json').val();json_vars=jQuery.parseJSON(json_vars);var title_token_rom=json_vars.title_token;var is_in_rom_related=$('#rom.rent-from-rom-similars').length>0;var individual_disc=json_vars.individual_disc||0;var added_format=json_vars.added_format;html_similars_present=$('#rom #similar_titles').length;queue_item_token=json_vars.queue_item_token;if(rom_type=='rent-from-rom-similars'||is_in_rom_related){rom_type='rent-from-rom-similars';}
var priorities=["High","Normal","Low"];var new_priority=$(this).val();var starting_priority_sub_string=priorities[starting_priority-1];var new_priority_sub_string=priorities[new_priority-1];var track_activity="priority_change_"+starting_priority_sub_string+"_to_"+new_priority_sub_string;track_activity=track_activity.toUpperCase()
var widget_name=starting_priority_sub_string+" to "+new_priority_sub_string+" Priority";$(this).attr("data-track_activity",track_activity);$(this).attr("data-widget_name","ROM: "+widget_name);$(this).attr("data-product_media",added_format);var params={reload:1,js_action:'change_priority',title_token:title_token_rom,new_priority:new_priority,queue_item_token:queue_item_token,rom_type:rom_type,individual_disc:individual_disc,html_similars_present:html_similars_present,title:title_token_rom};$(this).bubbleRentalOptions($button,params);var track_data=LOVEFiLM.Tracking.gatherTrackingData($(this).find('option:selected'));LOVEFiLM.Tracking.trackActivity(track_activity,track_data);});},bubbleRentalOptions:function($button,params){$button.bubbleAjax(params);},updateRentalList:function(count){LOVEFiLM.trigger('update.rental-list',{total:count});},jsonRemove:function($button,params,$bubble){var button_title_token=params.title_token;var rom_title_token=params.remove_self_token;var update_button=rom_title_token&&button_title_token&&button_title_token!=rom_title_token?0:1,show_span=0;if(update_button){var span_action_format=$button.find('span strong').text()||'';$button.html($p.removingText+span_action_format);}
$button.addClass('working');$.getJSON('/apps/foundation/ajax/action.html',params,function(json){if(json.success){$button.removeClass('working');if($bubble){$bubble.remove();}
$button.attr('data-track_activity',function(index,attr){switch(attr){case'QUEUE_REMOVE':return'QUEUE_ADD';break;case'QUEUE_BONUS_REMOVE':return'QUEUE_BONUS_ADD';break;}});if(update_button){$button.attr('data-queue',json.actionToken||'');$button.attr('data-bonus-queue',json.bonusActionToken||'');var added_format=json.buttonFormat,button_html=json.buttonText,buttonSpanFormats=json.buttonSpanFormats;$button.html(button_html);$button.attr('data-track_event',added_format);$button.attr('data-product_media',added_format);$button.attr('title',json.buttonText);$button.changeButtonClass(json.buttonClass);$('#rentalListCount').updateTopQueue('number',json.uniqueTitleCount);var button_type=params.button_type;if(button_type=="title_page_rolled_up"||button_type=="individual_disc"){$button.updateOtherPageButtons(json);}else{var count=json.unique_title_count||json.uniqueTitleCount;if(count){$button.updateRentalList(count);}}
jQuery.each(jQuery.browser,function(i){if($.browser.msie){if($.browser.version=='6.0'){$('#all_wrap div.highlight-titles-box select').show();}}});}}else{$button.after('<span>'+LOVEFiLM.i18n.i18n('/global/queue/login_fail')+'</span>');}});},bubbleAjax:function(params){var $button=$(this);var loader_content='<div id="bubble-title-bar" class="bubble_title_bg clearfix"><h4 class="header">'+$p.pleaseWaitText+'</h4></div><div class="bubble_container_bg"><div class="blank_content"></div></div>';var rom_type_specific_class=params.rom_type;var bubble_html=LOVEFiLM.bubble.bubbleHTML('rom','rent-manager-simple '+rom_type_specific_class,loader_content);var all_wrap=$('#all_wrap');var wrapper=all_wrap.length>0?all_wrap:$('body:first');if(!params.reload){wrapper.append(bubble_html);}
var $bbl=$('#rom');$bbl.show();$bbl.loadingRom();var json_vars=$bbl.find('#json').val();json_vars=jQuery.parseJSON(json_vars);LOVEFiLM.bubble.bubblePosition($bbl,$button,'rental_manger');if(params.reload){if(params.js_action!='add'&&params.js_action!='reserve'&&params.js_action!='change_format'){params.defined_unique_title_count=json_vars.unique_title_count;}
var $multi_queue_html=$bbl.find('#rent_queue_change').html();if(params.js_action!='change_queue'&&$multi_queue_html){params.multi_queue_html=$multi_queue_html;}}
var span_action_format=$button.find('span strong').text()||'';var show_span=span_action_format?1:0;ajax_in_progress++;$button.addClass('working');$.ajax({type:'POST',url:'/apps/catalog/ajax/bubble.html',data:params,success:function(data){$button.removeClass('working');$button.attr('data-track_activity',function(index,attr){switch(attr){case'QUEUE_ADD':return'QUEUE_REMOVE';break;case'QUEUE_BONUS_ADD':return'QUEUE_BONUS_REMOVE';break;}});ajax_in_progress--;if(!params.reload&&params.rom_type=='rent-from-rom-similars'&&!$('#rom #similar_titles').length){wrapper.append(bubble_html);}
$bubble=$('#rom');$bubble.find('.loader_img').remove();$bubble.find('.rom_loader').remove();if(params.rom_type=='rent-from-rom-similars'){$bubble.addClass('rent-from-rom-similars');}
if(params.js_action=='add'||params.js_action=='reserve'||params.js_action=='change_bonus'){$bubble.find('#similar_titles').remove();}
var $content=$bubble.find('.content');$content.html(data);var $simz=$content.find('#similar_titles');if($simz.length){$simz.insertAfter($content);var goto_product_links=$('#similar_titles .goto_product');}
if(!$bubble.length){$bubble=$(data);}
var json_vars=$bubble.find('#json').val();json_vars=jQuery.parseJSON(json_vars);var button_type=params.button_type;if(button_type=="title_page_rolled_up"||button_type=="individual_disc"){$bubble.updateOtherPageButtons(json_vars);}else{if(json_vars.unique_title_count){$button.updateRentalList(json_vars.unique_title_count);}}
if(params.rom_type!='rent-from-rom-similars'){if(params.reload!=1){var new_action_class=json_vars.new_action_class;$button.changeButtonClass(new_action_class);}
var new_action_token=json_vars.new_action_token;$button.attr('data-queue',new_action_token);var new_bonus_action_token='';if($('#change_bonus a').hasClass('remove')){new_bonus_action_token=$('#change_bonus a').attr('rel');}
$button.attr('data-bonus-queue',new_bonus_action_token);var new_action_text=(button_type=="title_page_rolled_up")?LOVEFiLM.i18n.i18n('/global/buttons/remove_from_rental_list'):json_vars.new_action_text;var button_title=LOVEFiLM.i18n.i18n('/global/buttons/remove_from_rental_list');var new_action_track=json_vars.new_action_track;$button.attr('data-track_event',new_action_track);var added_format=json_vars.added_format;$button.attr('data-product_media',added_format);if(!json_vars.queue_failed)$button.text(new_action_text);$button.attr('title',button_title);if(params.rom_type=='with-similars'||button_type=="title_page_rolled_up"){var actioned_format=added_format||span_action_format||'';if(!json_vars.queue_failed)$button.html(new_action_text);}}else{$button.attr('title',new_action_text);var new_action_track=json_vars.new_action_track;$button.attr('data-track_event',new_action_track);var added_format=json_vars.added_format;$button.attr('data-product_media',added_format);}
if($('#rom #similar_titles').length>0){LOVEFiLM.widget.init($('#rom #similar_titles'));}
$button.loadBubbleSniffers($bubble);$('#bubble-close').RemoveRentalOptions();var has_similars=json_vars.has_similars,rom_type=json_vars.rom_type;if(has_similars&&rom_type=='with-similars'){if($bubble.find('#similar_titles').length>0){$('#rom').css('width','475px');}
$bubble.find('.width_4').css('width','406px');}
if(ajax_in_progress==0&&hide_bubble==0){$('#rom').show();LOVEFiLM.bubble.bubblePosition($('#rom'),$button,'rental_manger');LOVEFiLM.bubble.bubblePosition($('#rom'),$button,'rental_manger');}
jQuery.each(jQuery.browser,function(i){if($.browser.msie){if($.browser.version=='6.0'){$('#all_wrap div.highlight-titles-box select').hide();$('#bubble-content select').show();}}});},error:function(){ajax_in_progress--;}});},loadingRom:function(){if(typeof hidePlayer==='function'){hidePlayer();}
var $bubble=$(this),$rom_loader=$bubble.find('.rom_loader:first');if($rom_loader.length<1){$bubble.append('<div class="rom_loader"></div>');$rom_loader=$bubble.find('.rom_loader:first');}
var bubble_width=$bubble.width(),bubble_height=$bubble.height();if(!bubble_height||bubble_height<30){bubble_height=100;$bubble.height(bubble_height);}
var $header_wrap=$bubble.find('#bubble-title-bar'),height_offset=$header_wrap.height();bubble_height=Math.round(bubble_height-height_offset);var $header=$header_wrap.find('h4:first');$header.text($p.pleaseWaitText);$rom_loader.css({'width':bubble_width+'px','height':bubble_height+'px','position':'absolute','top':height_offset+'px','left':'0px','z-index':'1'});var $loader_img=$bubble.find('.loader_img:first');if($loader_img.length<1){$bubble.append('<div class="loader_img"></div>');$loader_img=$bubble.find('.loader_img:first');}
$loader_img.css({'width':bubble_width+'px','height':bubble_height+'px','position':'absolute','top':height_offset+'px','left':'0px','z-index':'2'});jQuery.each(jQuery.browser,function(i){if($.browser.msie){if($.browser.version=='6.0'){$('#all_wrap div.highlight-titles-box select').hide();}}});},updateTopQueue:function(type,change){if(type=='number'){val=parseInt(change);var text=$(this).text();text=text.replace(/^[0-9]*/g,val);$(this).text(text);}},changeButtonClass:function(newClass){var $button=$(this);$button.removeClass('btn_add');$button.removeClass('btn_reserve');$button.removeClass('btn_remove');$button.addClass(newClass);return false;},RemoveRentalOptions:function(){$(this).click(function(e){e.preventDefault();$('#rom').remove();if(typeof showPlayer==='function'){showPlayer();}
jQuery.each(jQuery.browser,function(i){if($.browser.msie){if($.browser.version=='6.0')$('#all_wrap div.highlight-titles-box select').show();}});});}};$.each(newMethods,function(i){$.fn[i]=this;});return this.each(function(){$this=$(this);});};})(jQuery);;(function($){$.fn.hoverIntent=function(f,g){var cfg={sensitivity:7,interval:100,timeout:0};cfg=$.extend(cfg,g?{over:f,out:g}:f);var cX,cY,pX,pY;var track=function(ev){cX=ev.pageX;cY=ev.pageY;};var compare=function(ev,ob){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t);if((Math.abs(pX-cX)+Math.abs(pY-cY))<cfg.sensitivity){$(ob).unbind("mousemove",track);ob.hoverIntent_s=1;return cfg.over.apply(ob,[ev]);}else{pX=cX;pY=cY;ob.hoverIntent_t=setTimeout(function(){compare(ev,ob);},cfg.interval);}};var delay=function(ev,ob){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t);ob.hoverIntent_s=0;return cfg.out.apply(ob,[ev]);};var handleHover=function(e){var p=(e.type=="mouseover"?e.fromElement:e.toElement)||e.relatedTarget;while(p&&p!=this){try{p=p.parentNode;}catch(e){p=this;}}if(p==this){return false;}var ev=jQuery.extend({},e);var ob=this;if(ob.hoverIntent_t){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t);}if(e.type=="mouseover"){pX=ev.pageX;pY=ev.pageY;$(ob).bind("mousemove",track);if(ob.hoverIntent_s!=1){ob.hoverIntent_t=setTimeout(function(){compare(ev,ob);},cfg.interval);}}else{$(ob).unbind("mousemove",track);if(ob.hoverIntent_s==1){ob.hoverIntent_t=setTimeout(function(){delay(ev,ob);},cfg.timeout);}}};return this.mouseover(handleHover).mouseout(handleHover);};})(jQuery);;jQuery.fn.adWidgets=function($params){var $defaults={};var $p=jQuery.extend($defaults,$params);var $this=jQuery(this);var ie6=false;var newMethods={corner_peel:function($paramaters){var $defs={ContainerID:'pageflip',flipImagePath:'/lovefilm/images/page_flip.png',ImageHref:'%c%u',ImagePath:'',ImageAltTag:"",target:"_blank"};var $v=jQuery.extend($defs,$paramaters);$(this).prepend('<div id='+$v.ContainerID+'></div>');$('#'+$v.ContainerID).html('<a href="'+$v.ImageHref+'" target="'+$v.target+'"><img src="'+$v.flipImagePath+'" alt="'+$v.ImageAltTag+'" /></a><div class="msg_block"></div>').css({position:'relative',right:0,top:0,float:'right','z-index':30}).hover(function(){$("#pageflip img, .msg_block").stop().animate({width:'248px',height:'256px'},500);},function(){$("#pageflip img").stop().animate({width:'80px',height:'84px'},220);$(".msg_block").stop().animate({width:'80px',height:'80px'},200);}).find('img').css({width:'80px',height:'84px','z-index':32,border:'none',position:'absolute',right:0,top:0,'-ms-interpolation-mode':'bicubic'});$('.msg_block').css({width:'80px',height:'80px',overflow:'hidden',position:'absolute',right:'0',top:'0','z-index':31,background:'url('+$v.ImagePath+') no-repeat right top'});},sponsor:function($paramaters){var $defs={type:'overlap',header:{text:"",href:""},ads:[],default_target:"_blank"};var $v=jQuery.extend($defs,$paramaters);if(!$v.ads.length)return;var $sponsored=$(this).find('div.dart');var headingLevel=($(this).parents('div.tabbed_content_data').length===0)?'h2':'h4';var header=($v.header.href)?'<'+headingLevel+'><a href="'+$v.header.href+'" target="'+$v.default_target+'">'+$v.header.text+'</a></'+headingLevel+'>':'<'+headingLevel+'>'+$v.header.text+'</'+headingLevel+'>';$sponsored.append(header);$sponsored.removeClass('empty');var ads='<ol class="'+$v.type+'">';$.each($v.ads,function(i){var ad=$v.ads[i];var target=ad.img.target||$v.default_target;var style=(i%2===0)?'even':'odd';var element='<li class="'+style+'">';element+=' <a href="'+ad.img.url+'" target="'+target+'">';element+='<img src="'+ad.img.src+'"';element+=' width="'+ad.img.width+'"';element+=' height="'+ad.img.height+'"';element+=' alt="'+ad.img.alt+'"';element+=' />';element+='<span>'+ad.text+'</span>';element+='</a>';element+='</li>';ads+=element;});ads+='</ol>';$sponsored.append(ads);if($v.type.toLowerCase()==='carousel'){var $carObject=$sponsored.find('ol.carousel');$carObject.after('<div class="carouselNav"><ol></ol></div>');var $carNav=$sponsored.find('.carouselNav');$carNav.prepend('<a href="#" class="sponsored_prev">Previous</a>');$carNav.append('<a href="#" class="sponsored_next">Next</a>');var $carousel=$carObject.cycle({fx:'scrollHorz',timeout:4000,speed:500,prev:'.carouselNav .sponsored_prev',next:'.carouselNav .sponsored_next',pager:'.carouselNav ol',pagerAnchorBuilder:function(idx,slide){return'<li><a href="#">'+idx+'</a></li>';}});if(($.browser.msie&&$.browser.version=="8.0")||!$.browser.msie){$(this).find('.carouselNav ol').eq(0).css({'display':'inline-table'}).find('li').css({'display':'table-cell'});}
$carNav.find('ol a, .sponsored_next, .sponsored_prev').bind('click',function(){$carousel.cycle('pause');});}},pageskin:function($paramaters){var $defs={minSpaceRequired:0,showLeader:0};var $v=jQuery.extend($defs,$paramaters);if($('#pageContainer').length&&!$("#InSkinContainer_myInSkin2").length){$('#pageContainer').wrap('<div id="InSkinContainer_myInSkin2" class="InSkinContainer"><div id="InSkinContentContainer_myInSkin2" style="width: 993px; background-color:#fff; position:absolute;"><div id="pageSkinPageContainer" style="position: relative; text-align: left; width: 993px;"></div></div></div>');$('#InSkinContainer_myInSkin2').prepend('<div id="InSkinBaseContainer_myInSkin2" class="InSkinBaseContainer"><div id="InSkinIDiv_myInSkin2"></div></div>');$.getScript("http://inskin.vo.llnwd.net/o21/ikit/default/js/inskin_load.js",function(){InSkinParams=new Array();InSkinParams['srv_SectionID']='123880';InSkinParams['srv_SectionIDPlay']='';InSkinParams['srv_Keywords']='';InSkinParams['srv_Categories']='';InSkinParams['srv_UseSAS']='false';InSkinParams['sas_PauseAdTag']='';InSkinParams['plr_InSkinID']='myInSkin2';InSkinParams['plr_ContentID']='myContent2';InSkinParams['plr_ContentW']='993';InSkinParams['plr_ContentH']='2870';InSkinParams['plr_FrameTop']='90';InSkinParams['plr_FrameSide']='133';InSkinParams['plr_FrameBottom']='90';InSkinParams['plr_TotalW']='900';InSkinParams['plr_TotalH']='600';InSkinParams['plr_ContentType']='PAGE';InSkinParams['plr_ExpandableDetached']='true';InSkinParams['plr_NoSkinInSkinResize']='true';InSkinParams['plr_AssumeSkin']='false';InSkinParams['plr_InitOnLoad']='true';InSkinParams['plr_InitAfterContent']='false';var contentH=InSkinParams['plr_ContentH']=$('#InSkinContentContainer_'+InSkinParams['plr_InSkinID']).height();var contentW=InSkinParams['plr_ContentW'];var contentwidth=parseInt(contentW);var plrSideW=InSkinParams['plr_FrameSide'];var plrSideWidth=parseInt(plrSideW);var spacerequired=contentwidth+plrSideWidth*2;if($v.minSpaceRequired>0){spacerequired=$v.minSpaceRequired;}
var w=screen.width;if(w>spacerequired){$('head').append('<link type="text/css" rel="stylesheet" href="http://inskin.vo.llnwd.net/o21/ikit/default/css/default.css" />');$('.dart').addClass('InSkinHide');$('body').css({'margin':'0'});$('#topSearch').css({'left':'726px'});$('#autoComplete').css({'z-index':'50000'});if($v.showLeader){$('#pageContainer').append($('#advertLEADERBOARD'));}
$('#mnav li ul.drop_down').css({'left':'-1px'});$('div.trailer_panel div.prd_img_wrap').css({'margin-left':'0','padding-left':'3px'});InSkinLoad.init(InSkinParams);}});}}};jQuery.each(newMethods,function(i){jQuery.fn[i]=this;});return this.each(function(){$this=$(this);});};$(document).ready(function(){readCompJSON();});function readCompJSON()
{if($('div#comp_links').length)
{$.ajax({type:"GET",url:'/ajax/widgets/advertising/competitions_data.html',dataType:"json",success:function(json){$(json.comp).each(function(i,data){var comp='<a href="%%LINK%%" target="%%TARGET%%" class="competition"><div class="comp%%CLASS%%"><img src="%%IMAGE%%" /><div class="link"><span>%%COPY%%</span></div></div></a>';if(i==0){comp=comp.replace('%%CLASS%%',' first');}
else{comp=comp.replace('%%CLASS%%','');}
comp=comp.replace('%%IMAGE%%',$.trim(data.image));comp=comp.replace('%%LINK%%',$.trim(data.link));comp=comp.replace('%%TARGET%%',$.trim(data.target));comp=comp.replace('%%COPY%%',$.trim(data.copy));$(comp).appendTo('div#comp_links');});}});}};(function($){var PREFIX='data-',PREFIX_LEN=5;function _hyphenatedToCamelCase(str){return str.replace(/-([a-z0-9])/,function(str,c){return c.toUpperCase();});}
$.fn.getTitleToken=function(){var $ele=$(this),titleTokenAttr=PREFIX+'title_token',titleToken;titleToken=$ele.closest('['+titleTokenAttr+']').attr(titleTokenAttr);return titleToken;};$.fn.dataAttrs=function(){var data={},i,length,attr,node=this.get(0);if(node.dataset){data=node.dataset;}else{for(i=0,length=node.attributes.length;i<length;i++){attr=node.attributes[i];if(attr.nodeName.indexOf(PREFIX)===0){var key=_hyphenatedToCamelCase(attr.nodeName.substr(PREFIX_LEN));data[key]=attr.nodeValue;}}}
return data;};}(jQuery));;(function($){var LOVEFiLM=window.LOVEFiLM||{},QUEUE_ADD_ENDPOINT={method:'POST',url:'/ajax/rental/add_to_queue.html'},QUEUE_DELETE_ENDPOINT={method:'POST',url:'/ajax/rental/remove_from_queue.html'},QUEUE_MOVE_ENDPOINT={method:'POST',url:'/ajax/rental/switch_to_queue.html'},QUEUE_PRIORITY_ENDPOINT={method:'POST',url:'/ajax/rental/update_priority.html'},QUEUE_CHANGE_FORMAT_ENDPOINT={method:'POST',url:'/ajax/rental/set_queue_item_format.html'},SWITCH_QUEUE_ENDPOINT={method:'POST',url:'/ajax/rental/make_default_queue.html'};var properties={userTokenId:''};var processItem=function(item,defaultParams){var params=defaultParams||{};if(typeof item==='string'||typeof item==='number'){params.product_id=parseInt(item,10);}else if(item&&typeof item==='object'){if(item.productId){params.product_id=parseInt(item.productId,10);}
if(item.queueId){params.queue_id=parseInt(item.queueId,10);if(isNaN(params.queue_id)){params.error='Invalid queue id';}}
if(item.check_parent){params.check_parent=item.check_parent;}}
if(!params.product_id||isNaN(params.product_id)){params.error='Invalid product id';}
return params;};LOVEFiLM.RentalList={init:function(props){$.extend(properties,props);},addProduct:function(item,successCallback,failureCallback){var self=this,defaultQueueId=LOVEFiLM.RentalList.getQueueId(),params=processItem(item,{user_token_id:properties.userTokenId,queue_id:parseInt(defaultQueueId,10)});if(params.error){if(failureCallback){failureCallback(params.error,item);}
return;}
params.add_to_rental_list=params.product_id;LOVEFiLM.request.json(QUEUE_ADD_ENDPOINT.method,QUEUE_ADD_ENDPOINT.url,params)
.success(function(data){var section;if(data&&data.success){if(data.section){section=data.section;}
if(section==="available"){properties.rentalListSize++;}
LOVEFiLM.trigger('add.rental-list',{total:properties.rentalListSize,section:section,action:'add',input:params,output:data});LOVEFiLM.trigger('update.rental-list',{total:properties.rentalListSize,section:section,action:'add',input:params,output:data});if(successCallback){successCallback(data,params);}}})
.error(function(error){self.defaultFailureCallback(error,params);if(failureCallback){failureCallback(error,params);}});},deleteProduct:function(item,successCallback,failureCallback){var self=this,params=processItem(item,{user_token_id:properties.userTokenId});params.remove_from_rental_list=params.product_id;LOVEFiLM.request.json(QUEUE_DELETE_ENDPOINT.method,QUEUE_DELETE_ENDPOINT.url,params)
.success(function(data){if(data&&data.success){if(data.section==='available'&&data.parent_removed===1){properties.rentalListSize--;if(properties.rentalListSize<0){properties.rentalListSize=0;}}
LOVEFiLM.trigger('delete.rental-list',{total:properties.rentalListSize,action:'delete',section:data.section,input:params,output:data});LOVEFiLM.trigger('update.rental-list',{total:properties.rentalListSize,action:'delete',section:data.section,input:params,output:data});if(successCallback){successCallback(data);}}})
.error(function(error){self.defaultFailureCallback(error,item);if(failureCallback){failureCallback(error,item);}});},moveProduct:function(item,successCallback,failureCallback){var self=this,section=item.section,params=processItem(item,{user_token_id:properties.userTokenId});if(properties.currentQueueId){params.source_queue_id=properties.currentQueueId;}
LOVEFiLM.request.json(QUEUE_MOVE_ENDPOINT.method,QUEUE_MOVE_ENDPOINT.url,params)
.success(function(data){if(data&&data.success){LOVEFiLM.trigger('move.rental-list',{total:properties.rentalListSize,action:'move',section:section,input:params,output:data});LOVEFiLM.trigger('update.rental-list',{total:properties.rentalListSize,action:'move',section:section,input:params,output:data});if(successCallback){successCallback(data);}}})
.error(function(error){self.defaultFailureCallback(error);if(failureCallback){failureCallback(error);}});},changeProductFormat:function(item,successCallback,failureCallback){var self=this,params=processItem(item,{user_token_id:properties.userTokenId,queue_id:parseInt(properties.defaultQueueId,10)});params.new_format=item.newFormat;if(!params.product_id||!params.new_format||params.queue_id===undefined){if(failureCallback){failureCallback("Missing mandatory information");}
return;}
LOVEFiLM.request.json(QUEUE_CHANGE_FORMAT_ENDPOINT.method,QUEUE_CHANGE_FORMAT_ENDPOINT.url,params)
.success(function(data){if(data&&data.success){LOVEFiLM.trigger('change-format.rental-list',{action:'format-change',input:params,output:data});LOVEFiLM.trigger('update.rental-list',{total:properties.rentalListSize,action:'format-change',input:params,output:data});if(successCallback){successCallback(data);}}})
.error(function(error){self.defaultFailureCallback(error);if(failureCallback){failureCallback(error);}});},changeDefaultQueue:function(queueId,successCallback,failureCallback){var self=this;LOVEFiLM.request.json(SWITCH_QUEUE_ENDPOINT.method,SWITCH_QUEUE_ENDPOINT.url,{queue_id:queueId})
.success(function(data){if(data&&data.success){properties.defaultQueueId=data.queue_id;properties.defaultQueueName=data.queue_name;LOVEFiLM.trigger('switch.rental-list',{action:'switch-queue',queueId:properties.defaultQueueId,queueName:properties.defaultQueueName});if(successCallback){successCallback(data);}}})
.error(function(error){self.defaultFailureCallback(error);if(failureCallback){failureCallback(error);}});},changeProductPriority:function(item,successCallback,failureCallback){var self=this,params=processItem(item,{user_token_id:properties.userTokenId,queue_id:parseInt(properties.defaultQueueId,10)});params.priority=item.priority;LOVEFiLM.request.json(QUEUE_PRIORITY_ENDPOINT.method,QUEUE_PRIORITY_ENDPOINT.url,params)
.success(function(data){if(data&&data.success){LOVEFiLM.trigger('prioritise.rental-list',{action:'prioritise',input:params,output:data});LOVEFiLM.trigger('update.rental-list',{total:properties.rentalListSize,action:'prioritise',input:params,output:data});if(successCallback){successCallback(data);}}})
.error(function(error){self.defaultFailureCallback(error);if(failureCallback){failureCallback(error);}});},getHideDeleteConfirmBox:function(){var return_val=false;if(properties.hideDeleteConfirm==='Y'){return_val=true;}
return return_val;},setHideDeleteConfirmBox:function(val){if(val===true){properties.hideDeleteConfirm='Y';}else{properties.hideDeleteConfirm='';}},getSeriesToggleState:function(section){var pref=properties.seriesToggleState[section],return_val;if(pref==='Y'){return_val='expand';}else{return_val='collapse';}
return return_val;},setSeriesToggleState:function(section,val){var pref_val;if(val==='expand'){pref_val='Y';}else{pref_val='N';}
if(section){properties.seriesToggleState[section]=pref_val;}},getQueueId:function(){return properties.currentQueueId||properties.defaultQueueId;},hasMultipleLists:function(){return!!(properties.customerQueues&&properties.customerQueues.length>1)||false;},customerQueues:function(){return properties.customerQueues;},defaultFailureCallback:function(){}};}(jQuery));;(function(){LOVEFiLM=window.LOVEFiLM||{};LOVEFiLM.bubble=LOVEFiLM.bubble||{};var hoverHttpRequest;LOVEFiLM.widget.define('bubble-hover-detail',{init:function($el,options){this.superApply('init',arguments);var self=this;var $hoverTrigger=null;var $playEl=$($el).find('a.play-overlay');if($playEl.length){$hoverTrigger=$playEl;}else{$hoverTrigger=$($el).find('a.cover_link');}
$($hoverTrigger).hoverIntent({interval:200,over:self.bubbleOver,timeout:0,out:self.bubbleOut})
.data('self',self);},bubbleOver:function(){var trigger=$(this).parent().find('a.cover_link'),self=$(this).data('self'),sel=trigger.parents('.lf-bubble-hover-detail:first');jQuery.each(jQuery.browser,function(i){if($.browser.msie){if($.browser.version=='6.0')$('#all_wrap select').hide();}});var title_id=trigger.attr('data-title_token');var pref_format='';var find_media=sel.find('ul.text_btn li a').each(function(index){var link=$(this);if(link.hasClass('btn_add')||link.hasClass('btn_reserve')||link.hasClass('btn_remove')||link.hasClass('btn_at_home')){pref_format=link.attr('data-product_media')||'';}});var data={title_token:title_id,type:'hover_details',pref_format:pref_format};if(sel.hasClass('compact_v3')){data.show_production_year_v3=1;}
var prev_hover_data=trigger.find('div.hover_data:first').html();if(prev_hover_data){$("#hover_details").hide();self.bubbleUpdate(trigger,prev_hover_data,title_id,pref_format);}else if(title_id){hoverHttpRequest=$.ajax({beforeSend:function(){$("#hover_details").hide();},url:"/apps/catalog/ajax/bubble.html",data:data,success:function(data,textStatus){self.bubbleUpdate(trigger,data,title_id,pref_format);}});}},bubbleOut:function(){jQuery.each(jQuery.browser,function(i){if($.browser.msie){if($.browser.version=='6.0')$('#all_wrap select').show();}});if(hoverHttpRequest){hoverHttpRequest.abort();$("#hover_details").remove();}
$("#hover_details").remove();},bubbleUpdate:function(trigger,bubble_content,title_id,pref_format){var self=this,bubble_html=self.bubbleHTML(),all_wrap=$('#all_wrap'),wrapper=all_wrap.length>0?all_wrap:$('body:first');wrapper.append(bubble_html);var hover_details=$("#hover_details"),hover_content=hover_details.find('div.content');hover_content.html('');hover_content.html(bubble_content);var prev_hover_data=trigger.find('div.hover_data').get(0);if(!prev_hover_data){trigger.append('<div style="display:none;" class="none hover_data">'+bubble_content+'</div>')}
var bold_format=pref_format;if(title_id&&bold_format){if(bold_format=="Xbox_360"){bold_format=bold_format.replace("\_"," ");}else{bold_format=bold_format.replace("\_","\-");}
var format_section_html=hover_details.find('table.core_details .formats_row').html();format_section_html=format_section_html.replace(bold_format,"\<b\>"+bold_format+"\<\/b\>");hover_details.find('table.core_details .formats_row').html(format_section_html);}
self.bubblePosition(hover_details,trigger);hover_details.show();},bubbleHTML:function(){return LOVEFiLM.bubble.bubbleHTML('hover_details','','');},bubblePosition:function(hover_details,trigger){return LOVEFiLM.bubble.bubblePosition(hover_details,trigger,'hover_details');}});}());;(function(){LOVEFiLM.widget.define('carousel',{init:function($el,options){this.superApply('init',arguments);var self=this;self.scroll_move=options.scroll_move||1;self.scroll_loop=options.scroll_loop||0;self.autoNext=options.auto_next||0;self.totalItems=options.total_items||0;self.ajaxUrl=options.scroll_ajax||0;self.scroll_position=options.scroll_position||0;self.timer=null;self.canShowMore=false;self.gotDomItems=false;self.visibleIndex=0;self.items=$el.find('.item');if(!self.items.length){return false;}
self.numItems=self.items.length;$el.find('.item img').each(function(index,value){var data_src=$(this).data('src')||'';if(data_src){$(this).attr('src',data_src);}});self.last_index=Math.round(self.numItems-1);self.itemWidth=$(self.items[0]).width();self.wrapperWidth=$el.find('.mask:first').width();self.$wrapper=this.$el.find('.wrapper:first');self.itemsPerPage=Math.round(self.wrapperWidth/self.itemWidth);self.totalPages=Math.ceil(self.numItems/self.itemsPerPage);if(self.itemWidth>self.wrapperWidth){self.updateCounts($el);}
if(self.totalItems>self.numItems){self.canShowMore=true;}
self.moveByNumItems=1;self.totalPages=Math.ceil(self.numItems/self.itemsPerPage);self.number_of_steps=options.show_steps==1?self.totalPages:0;self.resolveItemWidths();var x_positions=new Array();for(var i=0;i<=self.last_index;i++){var positive=Math.round(i*self.itemWidth);var negative=Math.round(0-positive);x_positions.push(negative);}
self.x_positions=x_positions;if(self.totalPages>1){self.gotDomItems=true;var disable=self.scroll_loop?'':'data-disable_previous="disabled"';var steps=self.number_of_steps?'data-steps="'+self.number_of_steps+'"':'';var next_prev_position=self.next_prev_position?'data-steps="'+self.next_prev_position+'"':'';$el.find('.lf-paginator').remove();var $paginatorEl=$('<div class="lf-widget lf-paginator" data-button_type="default" '+next_prev_position+' '+disable+' '+steps+'></div>');if(self.scroll_position=='with_title'){$el.find('.highlight-titles:first').append($paginatorEl);}else{$el.prepend($paginatorEl);}
LOVEFiLM.widget.init($el);self.paginator=LOVEFiLM.widget.get($paginatorEl);}
self.bind('change.paginator',function(e){var moveType=e.data;if(moveType==="autoNext"&&self.autoNext==1){moveType=this.$el.data('autoNext')=='off'?'':'next';}
var toIndex=0;if(moveType==="next"){toIndex=Math.round(this.visibleIndex+self.moveByNumItems);}else if(moveType==="previous"){toIndex=Math.round(this.visibleIndex-self.moveByNumItems);}else if(!isNaN(moveType)){toIndex=Math.round((moveType-1)*self.moveByNumItems);}
var can_move=moveType||moveType===0?true:false;var item_loop=can_move&&self.scroll_loop&&(toIndex<0||toIndex>Math.round(self.last_index-(self.itemsPerPage-1))||!isNaN(moveType))?1:0;if(self.gotDomItems&&toIndex>self.totalPages-1){self.gotDomItems=false;}
if(self.canShowMore&&!self.gotDomItems&&self.ajaxUrl&&can_move){var token=self.ajaxUrl;var $item=self.$wrapper.find('li.item:first');var $items=self.$wrapper.find('li.item');var item_type='default';var num_rows=$item.find('.row').length;var num_sub_items=$item.find('.sub_items').length;if(num_rows>0&&num_sub_items>0){item_type='mixed';}
this.paginator.changePaginator({disable:'ajaxing'});self.$wrapper.append('<li class="item loader"></li>');var $loader=self.$wrapper.find('.loader:first');$loader.css({'opacity':'0.5','position':'absolute','background':'#fff','height':$item.height(),'width':self.$wrapper.width()});var ajax_type='titles';var ajax_url='';var replace_all=0;if(ajax_type==='titles'){ajax_url='/apps/catalog/ajax/carousel.html';replace_all=1;}
var digital_only=0;var content_type='';var game_format='';var digitalOnlyData=$(this.$el).data('digital_only');var contentTypeData=$(this.$el).data('content_type');var gameFormatData=$(this.$el).data('game_format');if(digitalOnlyData)digital_only=1;if(contentTypeData&&contentTypeData.length)content_type=contentTypeData;if(gameFormatData&&gameFormatData.length)game_format=gameFormatData;if(ajax_url&&token&&item_type){$.ajax({url:ajax_url,data:{token:token,item_type:item_type,digital_only:digital_only,content_type:content_type,game_format:game_format},success:function(html){self.ajaxUrl=0;self.canShowMore=false;$loader.animate({opacity:0},400).remove();if(replace_all){$items.remove();}
self.$wrapper.append(html);if(ajax_type==='titles'){if($.fn.processRentalButtonAction){self.$wrapper.find('a.btn_add, a.btn_remove, a.btn_reserve').processRentalButtonAction();}
if(self.$wrapper.parents('#rom').length>0&&$.fn.loadBubbleSniffers){$(this).loadBubbleSniffers(self.$wrapper);}}
self.updateCounts(self.$wrapper);self.resolveItemWidths();if(item_loop){self.items_loop(toIndex,moveType);}else{var disable=self.disableButtons(toIndex);self.show(toIndex,disable);}
}});}}else if(can_move){if(item_loop){self.items_loop(toIndex,moveType);}else{var disable=self.disableButtons(toIndex);self.show(toIndex,disable);}}});if(self.paginator&&self.autoNext==1){self.$el.hover(function(){$.data(this,'autoNext','off');},function(){$.data(this,'autoNext','on');self.paginator.autoNext('autoNext');}).data('autoNext','on');self.paginator.autoNext('autoNext');}},disableButtons:function(toIndex){var self=this;var disable='';if(!self.scroll_loop){if(toIndex<=0){disable='previous';}else if(toIndex>=self.last_index&&!self.canShowMore){disable='next';}}
return disable;},updateCounts:function($el){var self=this;self.sub_items=null;self.numItems=0;self.itemWidth=0;self.itemsPerPage=0;var $sub_items=$el.find('.sub_items');if($sub_items.length){self.sub_items=$sub_items;self.numItems=self.sub_items.length;self.itemWidth=$(self.sub_items[0]).width();self.itemsPerPage=$el.find('.item:first .sub_items').length;self.totalPages=Math.ceil(self.numItems/self.itemsPerPage);self.last_index=Math.round(self.totalPages-1);}else{var $items=$el.find('.item');if(items.length){self.items=items;self.numItems=self.items.length;self.last_index=Math.round(self.numItems-1);}}
},resolveItemWidths:function(){var self=this;var itemsTotalWidth=0;var $foundItems=self.$wrapper.find('.item');if($foundItems.length){var itemsPageWidth=0;var pageCounter=0;var pageDataAttr='data-carousel-page';var maskWidth=self.$wrapper.closest('.mask:first').width();$foundItems.each(function(index){if(index==0&&$foundItems.length>1){$(this).attr(pageDataAttr,pageCounter);}
itemsPageWidth=Math.round(itemsPageWidth+$(this).outerWidth(true));if(index>0&&itemsPageWidth>maskWidth){itemsPageWidth=$(this).outerWidth(true);pageCounter++;$(this).attr(pageDataAttr,pageCounter);}
itemsTotalWidth=itemsTotalWidth+$(this).outerWidth(true);});self.last_index=pageCounter;}
self.$wrapper.width(Math.round(itemsTotalWidth));},items_loop:function(toIndex,moveType){if(!isNaN(moveType)){var current_step=this.$el.find('.item:eq('+this.visibleIndex+')').data('step');var current_index=Math.round((current_step-1)*this.moveByNumItems);this.visibleIndex=current_index;for(i=1;i<=Math.round(this.numItems);i++){var last_item_data=this.$el.find('.item').last().data('item');if(last_item_data!=i){this.$el.find('.item[data-carousel-page="'+i+'"]').insertAfter(this.$el.find('.item:last'));}}
this.$el.find('.wrapper:first').css('left',this.x_positions[Math.round(current_index)]);}else{var prev_reorder=toIndex<0?1:0;var from_index=prev_reorder?Math.round(this.visibleIndex+this.itemsPerPage):0;var to_index=prev_reorder?this.last_index:Math.round(this.visibleIndex-1);var extracted_items=new Array();for(i=from_index;i<=to_index;i++){var item=this.items[i];extracted_items.push(item);}
if(prev_reorder){$(extracted_items).prependTo(this.$el.find('.wrapper:first'));this.visibleIndex=Math.round(this.last_index-(this.itemsPerPage-1));this.$el.find('.wrapper:first').css('left',this.x_positions[this.visibleIndex]);toIndex=Math.round(this.visibleIndex-this.moveByNumItems);}else{$(extracted_items).appendTo(this.$el.find('.wrapper:first'));this.visibleIndex=0;this.$el.find('.wrapper:first').css('left','0');toIndex=Math.round(this.visibleIndex+this.moveByNumItems);}}
this.items=this.$el.find('.item');this.show(toIndex,'');},show:function(index,disable){var self=this;index=Math.max(0,Math.min(index,self.last_index));var animate=true;if((($('#rom').length>0)&&($('#rom.with-similars').length==0))||(self.visibleIndex==index)){animate=false;}
if(animate&&self.paginator){step=$(self.items[index]).data('step');self.paginator.changePaginator({disable:disable,step:step});}
if(animate){var previousIndex=self.visibleIndex;self.visibleIndex=index;var currentPosition=$('li.item[data-carousel-page="'+previousIndex+'"]',self.$wrapper).position();var nextPosition=$('li.item[data-carousel-page="'+(self.visibleIndex)+'"]',self.$wrapper).position();var leftPos=0;if(nextPosition&&currentPosition){var position=parseInt(nextPosition.left);if(position){leftPos='-'+parseInt(nextPosition.left);}}else if(!nextPosition&&currentPosition){var $firstPage=$('li.item[data-carousel-page="0"]',self.$wrapper);if($firstPage&&!self.canShowMore){self.paginator.changePaginator({disable:'next'});var maskWidth=$(self.$wrapper).closest('.mask:first').width();var defaultPageWidth=$firstPage.position().left;if(maskWidth<defaultPageWidth){maskWidth=defaultPageWidth;}
var lastItem=$('li.item',self.$wrapper).last();var lastPosition=$(lastItem).position();var lastWidth=$(lastItem).outerWidth(true);var farRight=parseInt(lastPosition.left+lastWidth);leftPos='-'+parseInt(farRight-maskWidth);}}
if(leftPos!==null){$(self.$wrapper).stop().animate({left:leftPos},500,function(){if(self.paginator&&self.autoNext==1)self.paginator.autoNext('autoNext');});}}}});LOVEFiLM.widget.define('paginator',{init:function($el,options){this.superApply('init',arguments);var self=this;var disable_previous=options.disable_previous;var button_type=options.button_type||'default';var number_of_steps=options.steps||0;var next_prev_position=options.next_prev_position||'XrightYtop';$el.append('<a class="previous '+disable_previous+'" data-track_activity="CAROUSEL_PREV"><span>Previous</span></a><a class="next" data-track_activity="CAROUSEL_NEXT"><span>Next</span></a>');if(number_of_steps){$el.prepend('<ul class="steps"></ul>');var step_content=$el.find('.steps:first');for(var i=1;i<=Math.round(number_of_steps);i++){var selected=i==1?'selected':'';step_content.append('<li class="step '+selected+'" data-step="'+i+'" data-track_activity="CAROUSEL_STEP">&#8226;</li>');}}
var next=$el.find('.next:first');var previous=$el.find('.previous:first');var steps=$el.find('.step');next.click(function(e){if(!next.hasClass('disabled')&&!next.hasClass('ajaxing')){if(!$('#rom.with-similars').length){$('#rom').remove();}
self.move('next');}
e.preventDefault();});previous.click(function(e){if(!previous.hasClass('disabled')){if(!$('#rom.with-similars').length){$('#rom').remove();}
self.move('previous');}
e.preventDefault();});steps.click(function(e){var $link=$(this),trackdata=LOVEFiLM.Tracking.gatherTrackingData($link);LOVEFiLM.Tracking.trackActivity(trackdata.track_activity,trackdata);if($('#rom.with-similars').length==0){$('#rom').remove();}
self.move($(this).data('step'));e.preventDefault();});},autoNext:function(moveType){var wait=9500;var self=this;window.clearTimeout(self.timer);self.timer=window.setTimeout(function(){self.trigger('change',moveType);},wait);},move:function(moveType){this.trigger('change',moveType);},changePaginator:function(data){var disable=data.disable;var step=data.step;var next=this.$el.find('.next:first');var previous=this.$el.find('.previous:first');var steps=this.$el.find('.step');if(disable=='ajaxing'){next.addClass('ajaxing');}else{next.removeClass('ajaxing');if(disable=='next'){next.addClass('disabled');}else{next.removeClass('disabled');}
if(disable=='previous'){previous.addClass('disabled');}else{previous.removeClass('disabled');}}
if(steps&&step>=0){steps.removeClass('selected');$(steps.get(Math.round(step-1))).addClass('selected');}}});}());;LOVEFiLM.widget.define('product-rating-stars',{init:function($el,options){this.superApply('init',arguments);var self=this;this._$ratingEl=$el.find('.star-rating');this._rating=this._$ratingEl.attr('data-current_rating');this._rating=parseFloat(this._rating)*2;this._wasUserRated=this._$ratingEl.hasClass('star-rating-member');$el.mouseenter(function(){var $ratingEl=$(this),width=$ratingEl.width(),offsetLeft=$ratingEl.offset().left;self._$ratingEl.addClass('star-rating-interactive');$(this).bind('mousemove',function(e){var offset=e.pageX-offsetLeft,pos=offset/width,hoverRating=Math.max(1,Math.ceil(pos*10));self._$ratingEl.attr('class',self._$ratingEl.attr('class').replace(/star-rating-\d+/,'star-rating-'+(hoverRating*10)));self._$ratingEl.attr('title',LOVEFiLM.i18n.i18n('/global/ratings/snap'+Math.round(hoverRating*10)));self._$ratingEl.parent('.star-base').attr('data-rating_tracking',hoverRating/2);});});$el.click(function(e){var $ratingEl=$(this),width=$ratingEl.width(),offsetLeft=$ratingEl.offset().left,offset=e.pageX-offsetLeft;self.rate(Math.ceil((offset/width)*10));$ratingEl.find('.star-rating').attr('data-current_rating',Math.ceil((offset/width)*10)/2);});$el.mouseleave(function(e){self._$ratingEl.removeClass('star-rating-interactive');self._$ratingEl.attr('class',self._$ratingEl.attr('class').replace(/star-rating-\d+/,'star-rating-'+(self._rating*10)));$(this).unbind('mousemove');});},rate:function(rating){this._rating=rating;var $el=this._$ratingEl.parents('.star_base:first, .star-base:first');this._$ratingEl.addClass('star-rating-member');this._$ratingEl.attr('class',this._$ratingEl.attr('class').replace(/star-rating-\d+/,'star-rating-'+(this._rating*10)));this._$ratingEl.html(LOVEFiLM.i18n.i18n('/lovefilm/global/widgets/star_ratings/member_rating',{'rating':$('<div></div>').append($('<span class="member-rating"></span>').text(LOVEFiLM.i18n.formatNumber(rating/2,{decimals:1}))).html(),'best_rating':$('<div></div>').append($('<span class="member-best"></span>').text(LOVEFiLM.i18n.formatNumber(5))).html()}));LOVEFiLM.request.json('POST',this.options['action_token']?'/apps/foundation/ajax/action.html':'/dynimgs/rate.html',{user_token_id:'1234',rating:this._rating/2,action_token:this.options['action_token'],rate_product:1,json_response:1,product_id:this.options['productId']}).success(function(data){var trackdata=LOVEFiLM.Tracking.gatherTrackingData($el);LOVEFiLM.Tracking.trackActivity(trackdata.track_activity,trackdata);});LOVEFiLM.trigger('rate.product',{action:'rate',type:this._wasUserRated?'update':'new',rating:this._rating/2,productId:this.options['productId']});this._wasUserRated=true;}});;LOVEFiLM.widget.define('unrec-product',{init:function($el,options){var self=this;$el.find('a.star_Rval').click(function(e){e.preventDefault();var action_token=$el.attr('data-rec')||0;if(!$(this).hasClass('not_rateable')){if(action_token){$(this).addClass('removeRow');var title=this;$.get("/ajax/action.html",{r:Math.random(),action_token:action_token},function(){if($(title).parents().hasClass('film_listings_content')||$(title).parents().hasClass('listview')){if($('.page-content .listview').hasClass('recommendations')){$(title).parents('.film_listing').slideUp(500);}}else if($(title).parents('.compact_info_snb')){$(title).parents('.compact_info_snb').slideUp(500,function(){$(title).parents('.compact_info_snb').hide(300);});}
hide_bubble=1;});}}
return $(this);});}});;(function($){var defaults={};var overlay={node:null,visible:false};var lfbox={node:null,visible:false};var focus={onComplete:null,inDocument:false,inLovefilmBox:false};$.fn.lovefilmbox=function(){defaults=$.extend({},$.fn.lovefilmbox.defaults);return this.each(function(){var link=$(this);if(link.hasClass('lfbox-active')){return;}
link.addClass('lfbox-active')
.click(function(e){var options=gatherOptions($(this));focus.onComplete=this;$.showLovefilmBox(options);if(options.fn){var content=$("#lovefilmbox div.lfbox_body");if(options.height&&options.width){var wrapper=$('<div></div>').css({height:options.height+'px',width:options.width+'px',overflow:'hidden'});content.append(wrapper);content=wrapper;}
options.fn(content,options);showLovefilmBox();}
e.preventDefault();});});};$.fn.lovefilmbox.defaults={height:200,width:300,opacity:0.8,overlay:'<div id="lfoverlay"></div>',lfbox_wrapper:'<div id="lovefilmbox"></div>',lfbox_close:'<a href="#" id="lfbox_close_btn" class="lfbox_close">'+
LOVEFiLM.i18n.i18n('/global/close_button')+
' <img height="16" width="16" alt="" src="/lovefilm/images/product/overlay-close.gif"/></a>',lfbox_body:'<div class="lfbox_body"></div>',image:'<img src="" alt="" />',iframe:'<iframe frameborder="0" />',loading:'<div class="lfbox_loading"><img src="/images/icons/ajax_load_black.gif" alt="" width="10" height="10" border="0"> '+LOVEFiLM.i18n.i18n('/lovefilm/visitor/login/loading')+'</div>'};$.showLovefilmBox=function(options){if(!options.type){return;}
if(!defaults.lfbox_wrapper){defaults=$.extend({},$.fn.lovefilmbox.defaults);}
createOverlay();createLovefilmBox(options);fadeInOverlay(function(){showLovefilmBox(options);});return $("#lovefilmbox div.lfbox_body");};function manageFocus(){if($(document).focusout){$("#lovefilmbox")
.bind("focusout.lfbox",function(e){focus.inLovefilmBox=false;if(focus.inDocument&&!focus.inLovefilmBox){reclaimFocus();}})
.bind("focusin.lfbox",function(e){focus.inLovefilmBox=true;});$(document)
.bind("focusout.lfbox",function(e){focus.inDocument=false;})
.bind("focusin.lfbox",function(e){focus.inDocument=true;if(focus.inDocument&&!focus.inLovefilmBox){reclaimFocus();}});}
setEntryFocus();};function setEntryFocus(){$("#lovefilmbox a.lfbox_close").focus();}
function setExitFocus(){if(focus.onComplete&&focus.onComplete.focus){focus.onComplete.focus();focus.onComplete=null;}}
function reclaimFocus(){focus.inDocument=true;focus.inLovefilmBox=true;setEntryFocus();};function unmanageFocus(){$(document).unbind(".lfbox");$("#lovefilmbox").unbind(".lfbox");};function closeAll(){hideOverlay();hideLovefilmBox();unmanageFocus();setExitFocus();};function createOverlay(){if(!overlay.node){overlay.node=$(defaults.overlay);overlay.node.click(function(e){closeAll();e.preventDefault();});$("body").append(overlay.node);}
overlay.node.css({height:$(document).height(),width:$(document).width(),opacity:0}).show();$(document).bind('keypress.lfbox',function(e){if(e.keyCode==27){closeAll();}});};function fadeInOverlay(callback){if(callback){overlay.node.animate({opacity:defaults.opacity},{complete:callback});}
else{overlay.node.animate({opacity:defaults.opacity});}
overlay.visible=true;};function hideOverlay(){if(overlay.visible){overlay.node.animate({opacity:0},{complete:function(){overlay.node.hide();overlay.visible=false;}});}};function createLovefilmBox(options){if(!lfbox.node){lfbox.node=$(defaults.lfbox_wrapper)
.append(defaults.lfbox_close)
.append(defaults.lfbox_body)
.addClass("offscreen");$("body").append(lfbox.node);$("#lovefilmbox").delegate('a.lfbox_close','click',function(e){closeAll();e.preventDefault();});}
$("#lovefilmbox div.lfbox_body")
.append(insertBoxContent(options));if(options.height&&options.width){centreLovefilmBox(options);}
$("#lovefilmbox")
.addClass("offscreen")
.show();};function showLovefilmBox(options){centreLovefilmBox();lfbox.node.removeClass("offscreen");};function centreLovefilmBox(options){var lfNode=lfbox.node;if(lfNode){var offset=$(document).scrollTop();var width=lfNode.width();var height=lfNode.height();var viewport={height:$(window).height(),width:$(window).width()};if(width==0){width=$(".lfbox_body",lfNode).width();}
var boxOffset={height:-height/2+offset,width:-width/2}
if(height>viewport.height){boxOffset.height=-viewport.height/2+offset;}
if(width>viewport.width){boxOffset.width=-(width+50-viewport.width/2);}
lfNode.css({'margin-top':(boxOffset.height)+'px','margin-left':(boxOffset.width)+'px'});}};function setLovefilmBoxContent(content){$("#lovefilmbox div.lfbox_body").append(content);centreLovefilmBox();};function removeLoadingMessage(){$("#lovefilmbox div.lfbox_body div.lfbox_loading").remove();}
function hideLovefilmBox(){$("#lovefilmbox").hide();$("#lovefilmbox div.lfbox_body").empty();};function gatherOptions(link){var options={type:link.attr('data-type'),width:link.attr('data-width'),height:link.attr('data-height'),src:link.attr('data-src')||link.attr('href'),animate:true};if(!options.type){options.type='image';}
switch(options.type){case'image':options.alt=link.attr('title');break;case'iframe':options.alt=link.attr('title');options.callback=link.attr('data-callback');options.ajaxUrl=link.attr('data-url')||options.src;if($.browser.msie){options.animate=false;}
break;case'div':options.selector=link.attr('data-selector');break;case'ajax':options.ajaxUrl=link.attr('data-url')||options.src;options.callback=link.attr('data-callback');break;case'swf':options.method=link.attr('data-callback');break;default:options.callback=link.attr('data-callback');break;}
return options;};function insertBoxContent(options){var content='';switch(options.type){case'image':content=getImageContent(options);break;case'iframe':content=getIframeContent(options);break;case'div':content=getDivContent(options);break;case'ajax':content=getAjaxContent(options);break;default:break;if(options.callback){var fn=stringToFunction(options.callback);if(typeof fn=='function'){options.fn=fn;}}}
return content;};function getImageContent(options){var image=new Image();var complete=false;function updateContentHandler(){complete=true;removeLoadingMessage();setLovefilmBoxContent($(defaults.image).attr({src:options.src,height:image.height||options.height,width:image.width||options.width,alt:options.alt}));};$(image).load(updateContentHandler);image.src=options.src;return(complete)?null:getLoadingContent(options);};function getIframeContent(options){var complete=false;function updateContentHandler(){complete=true;removeLoadingMessage();};return $(defaults.iframe)
.attr({src:options.ajaxUrl,height:options.height,width:options.width,title:options.alt})
.bind('load',updateContentHandler)
.add(getLoadingContent(options)
.css({position:'absolute',top:'0px',left:'0px',width:(1*options.width+40)+'px',height:'10px'}));};function getDivContent(options){var content=$(options.selector).clone();options.height=content.height();options.width=content.width();return content;};function getAjaxContent(options){var fn=null;if(options.callback){fn=stringToFunction(options.callback);}
var boxBody=$("#lovefilmbox div.lfbox_body");var complete=false;boxBody.load(options.ajaxUrl,function(response,status,xhr){complete=true;removeLoadingMessage();showLovefilmBox();if(fn&&typeof fn=='function'){fn(boxBody,response,status,xhr);}});return(complete)?null:getLoadingContent(options);};function getLoadingContent(options){var height=options.height||'100';var width=options.width||defaults.width;return $(defaults.loading).css({height:height+'px',width:width+'px',opacity:0.7});}
function stringToFunction(str){var segments=str.split('.');var fn=window;for(var i=0,j=segments.length;i<j;i++){if(fn[segments[i]]){fn=fn[segments[i]];}
else{return null;}}
if(typeof fn=='function'){return fn;}
return null;};})(jQuery);$(document).ready(function(){$("a.lovefilmbox").lovefilmbox();});;(function(){if(!(LOVEFiLM&&LOVEFiLM.perf&&LOVEFiLM.perf.timings)){return;}
var timings=LOVEFiLM.perf.timings;var extras={b:'brand',pt:'pageType',wl:'whitelabel',st:'status'};function send(){if(!LOVEFiLM.perf.BEACON_URL)return false;var beaconUrl=LOVEFiLM.perf.BEACON_URL+'?u='+encodeURIComponent(window.location);for(var name in timings){if(timings.hasOwnProperty(name)){beaconUrl+='&'+encodeURIComponent(name)+'='+encodeURIComponent(timings[name]);}}
for(var name in extras){if(extras.hasOwnProperty(name)&&LOVEFiLM.perf.hasOwnProperty(extras[name])){beaconUrl+='&'+encodeURIComponent(name)+'='+encodeURIComponent(LOVEFiLM.perf[extras[name]]);}}
var img=new Image();img.src=beaconUrl;return true;}
function onLoad(e){timings.l=(new Date()).getTime()-timings.start;setTimeout(function(){var nt=(window.performance&&window.performance.timing)||(window.webkitPerformance&&window.webkitPerformance.timing)||(window.msPerformance&&window.msPerformance.timing)||(window.mozPerformance&&window.mozPerformance.timing);if(nt){timings.dn=nt.domainLookupEnd-nt.domainLookupStart;timings.cn=nt.connectEnd-nt.connectStart;timings.wt=nt.responseStart-nt.requestStart;timings.dl=nt.responseEnd-nt.responseStart;timings.ld=nt.loadEventEnd-nt.loadEventStart;if('domContentLoadedEventEnd'in nt){timings.drd=nt.domContentLoadedEventEnd-nt.domContentLoadedEventStart;}else{timings.drd=nt.domContentLoadedEnd-nt.domContentLoadedStart;}
timings.rt=nt.loadEventEnd-nt.unloadEventEnd;}
var re=/^\s*([a-z0-9._-]+)\s+(\S+)\s+([a-z0-9-]+)\s+\(\d{6}(\d+\.\d+)\)\s*$/;var match;var node=document.body.lastChild;while(node){if(node.nodeType===8){if(match=re.exec(node.nodeValue)){LOVEFiLM.perf.timings.pb=Math.round(parseFloat(match[4])*1000);break;}}
node=node.previousSibling;}
send();},100);}
function onDomReady(e){LOVEFiLM.perf.timings.dr=(new Date()).getTime()-timings.start;}
if(window.addEventListener){window.addEventListener('load',onLoad,false);document.addEventListener('DOMContentLoaded',onDomReady,false);}else{window.attachEvent('onload',onLoad);}}());;